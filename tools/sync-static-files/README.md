# æ–‡ä»¶ç›‘è§†å’ŒåŒæ­¥å·¥å…·

## ğŸ¯ åŠŸèƒ½

è‡ªåŠ¨ç›‘è§† `static/` ç›®å½•çš„æ–‡ä»¶å˜åŒ–ï¼Œå½“æ£€æµ‹åˆ°å›¾ç‰‡æ–‡ä»¶çš„å¢åˆ æ”¹æ—¶ï¼š

1. è‡ªåŠ¨åˆ¤æ–­æ˜¯å“ªä¸ªäº§å“
2. è‡ªåŠ¨ç”Ÿæˆè¯¥äº§å“çš„æ–‡ä»¶åˆ—è¡¨
3. è‡ªåŠ¨åŒæ­¥åˆ° server ç«¯

## ğŸ“¦ å®‰è£…ä¾èµ–

```bash
pip3 install watchdog
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ 1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
./start-watch.sh
```

### æ–¹å¼ 2: ç›´æ¥è¿è¡Œ Python è„šæœ¬

```bash
python3 tools/sync-static-files/watch-and-sync.py
```

## ğŸ“‹ å·¥ä½œæµç¨‹

```
1. ç›‘è§† static/ ç›®å½•
   â†“
2. æ£€æµ‹åˆ°å›¾ç‰‡æ–‡ä»¶å˜åŒ–
   â†“
3. åˆ¤æ–­äº§å“ (å¦‚ business-headshot-ai)
   â†“
4. ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨
   tools/filelist-generator/business-headshot-ai/files.txt
   â†“
5. åŒæ­¥åˆ° server ç«¯
   /path/to/aipso-server/static/business-headshot-ai/files.txt
```

## ğŸ¬ ç¤ºä¾‹

### å¯åŠ¨ç›‘è§†

```bash
$ ./start-watch.sh

============================================================
ğŸ” æ–‡ä»¶ç›‘è§†å’ŒåŒæ­¥å·¥å…·
============================================================

ğŸ“ ç›‘è§†ç›®å½•: /path/to/aipso-static/static
ğŸ“ ç”Ÿæˆå™¨: /path/to/tools/filelist-generator/generate-filelist.py
ğŸ¯ åŒæ­¥ç›®æ ‡: /path/to/aipso-server/static

ğŸ’¡ æç¤º:
   â€¢ å½“ static/ ç›®å½•ä¸‹çš„å›¾ç‰‡æ–‡ä»¶å‘ç”Ÿå˜åŒ–æ—¶
   â€¢ è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨
   â€¢ è‡ªåŠ¨åŒæ­¥åˆ° server ç«¯
   â€¢ ä½¿ç”¨ Ctrl+C åœæ­¢ç›‘è§†

============================================================

âœ… ç›‘è§†å·²å¯åŠ¨ï¼Œç­‰å¾…æ–‡ä»¶å˜åŒ–...
```

### æ·»åŠ æ–‡ä»¶æ—¶

```bash
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ·»åŠ æ–‡ä»¶
$ cp new-image.webp static/business-headshot-ai/images/home/City/

# ç›‘è§†å·¥å…·è‡ªåŠ¨è¾“å‡ºï¼š
============================================================
ğŸ“ æ£€æµ‹åˆ°å˜åŒ–: business-headshot-ai
   äº‹ä»¶ç±»å‹: created
   æ–‡ä»¶: new-image.webp
============================================================

ğŸ”„ æ­¥éª¤ 1: ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨...
âœ… æ–‡ä»¶åˆ—è¡¨ç”ŸæˆæˆåŠŸ
   ğŸ“Š æ€»è®¡ 1098 ä¸ªæ–‡ä»¶
   ğŸ’¾ æ–‡ä»¶å¤§å°: 54.38 KB

ğŸ”„ æ­¥éª¤ 2: åŒæ­¥åˆ° server ç«¯...
âœ… åŒæ­¥æˆåŠŸ
   æº: tools/filelist-generator/business-headshot-ai/files.txt
   ç›®æ ‡: /path/to/aipso-server/static/business-headshot-ai/files.txt
   å¤§å°: 54.38 KB

============================================================
âœ… å¤„ç†å®Œæˆ: business-headshot-ai
============================================================
```

### åœæ­¢ç›‘è§†

æŒ‰ `Ctrl+C` åœæ­¢ï¼š

```bash
^C
ğŸ›‘ åœæ­¢ç›‘è§†...
ğŸ‘‹ å·²é€€å‡º
```

## âš™ï¸ é…ç½®

ç¼–è¾‘ `tools/sync-static-files/watch-and-sync.py` ä¸­çš„é…ç½®ï¼š

```python
# Server static ç›®å½•è·¯å¾„
SERVER_STORE_DIR = Path('/Users/luyunfei/Desktop/.../aipso-server/static')

# é˜²æŠ–åŠ¨æ—¶é—´ï¼ˆç§’ï¼‰
DEBOUNCE_SECONDS = 2

# æ”¯æŒçš„å›¾ç‰‡æ ¼å¼
IMAGE_EXTENSIONS = {'.webp', '.jpg', '.jpeg', '.png', '.gif'}
```

## ğŸ” ç›‘è§†çš„äº‹ä»¶

å·¥å…·ä¼šç›‘è§†ä»¥ä¸‹æ–‡ä»¶ç³»ç»Ÿäº‹ä»¶ï¼š

- `created` - æ–‡ä»¶åˆ›å»º
- `modified` - æ–‡ä»¶ä¿®æ”¹
- `deleted` - æ–‡ä»¶åˆ é™¤
- `moved` - æ–‡ä»¶ç§»åŠ¨

## ğŸš« å¿½ç•¥çš„æ–‡ä»¶

- éå›¾ç‰‡æ–‡ä»¶ï¼ˆæ ¹æ®æ‰©å±•ååˆ¤æ–­ï¼‰
- éšè—æ–‡ä»¶ï¼ˆä»¥ `.` å¼€å¤´ï¼‰
- ç›®å½•å˜åŒ–

## âš¡ é˜²æŠ–åŠ¨æœºåˆ¶

ä¸ºé¿å…çŸ­æ—¶é—´å†…é‡å¤è§¦å‘ï¼Œå·¥å…·å†…ç½®äº†é˜²æŠ–åŠ¨æœºåˆ¶ï¼š

- åŒä¸€äº§å“åœ¨ 2 ç§’å†…åªä¼šè§¦å‘ä¸€æ¬¡å¤„ç†
- é¿å…æ‰¹é‡æ“ä½œæ—¶äº§ç”Ÿå¤§é‡é‡å¤å¤„ç†

## ğŸ”§ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1: ç¼ºå°‘ watchdog ä¾èµ–

```bash
âŒ ç¼ºå°‘ä¾èµ–: watchdog

è¯·å®‰è£…ä¾èµ–:
  pip install watchdog
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
pip3 install watchdog
```

### é—®é¢˜ 2: Server static ç›®å½•ä¸å­˜åœ¨

```bash
âŒ è·¯å¾„æ£€æŸ¥å¤±è´¥:
   â€¢ Server static ç›®å½•ä¸å­˜åœ¨: /path/to/aipso-server/static
```

**è§£å†³æ–¹æ³•**ï¼š
1. æ£€æŸ¥ server é¡¹ç›®è·¯å¾„æ˜¯å¦æ­£ç¡®
2. ä¿®æ”¹ `tools/sync-static-files/watch-and-sync.py` ä¸­çš„ `SERVER_STORE_DIR` é…ç½®

### é—®é¢˜ 3: æƒé™é—®é¢˜

```bash
âŒ åŒæ­¥å¤±è´¥: [Errno 13] Permission denied
```

**è§£å†³æ–¹æ³•**ï¼š
```bash
# æ£€æŸ¥ç›®æ ‡ç›®å½•æƒé™
ls -ld /path/to/aipso-server/static/business-headshot-ai/

# å¦‚æœéœ€è¦ï¼Œä¿®æ”¹æƒé™
chmod 755 /path/to/aipso-server/static/business-headshot-ai/
```

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: å¼€å‘ç¯å¢ƒ

```bash
# ç»ˆç«¯ 1: å¯åŠ¨é™æ€æ–‡ä»¶æœåŠ¡å™¨
python3 dev_server.py

# ç»ˆç«¯ 2: å¯åŠ¨æ–‡ä»¶ç›‘è§†
./start-watch.sh

# ç»ˆç«¯ 3: å¯åŠ¨ server ç«¯
cd ../aipso-server
npm run dev

# ç°åœ¨æ·»åŠ å›¾ç‰‡ä¼šè‡ªåŠ¨åŒæ­¥åˆ° server ç«¯
cp new-image.webp static/business-headshot-ai/images/home/City/
```

### åœºæ™¯ 2: æ‰¹é‡å¯¼å…¥å›¾ç‰‡

```bash
# å¯åŠ¨ç›‘è§†
./start-watch.sh

# æ‰¹é‡å¤åˆ¶å›¾ç‰‡ï¼ˆä¼šè‡ªåŠ¨è§¦å‘ä¸€æ¬¡å¤„ç†ï¼‰
cp -r new-images/* static/business-headshot-ai/images/home/City/
```

### åœºæ™¯ 3: æµ‹è¯•ç¯å¢ƒ

```bash
# åœ¨æµ‹è¯•ç¯å¢ƒæŒç»­è¿è¡Œç›‘è§†å·¥å…·
nohup python3 tools/sync-static-files/watch-and-sync.py > watch.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f watch.log
```

## ğŸ“Š æ€§èƒ½è€ƒè™‘

- **CPU å ç”¨**ï¼šç›‘è§†å·¥å…·æœ¬èº«å ç”¨å¾ˆå°‘çš„ CPU
- **å†…å­˜å ç”¨**ï¼šçº¦ 20-30 MB
- **å“åº”æ—¶é—´**ï¼šæ£€æµ‹åˆ°å˜åŒ–å 2 ç§’å†…å¼€å§‹å¤„ç†
- **å¤„ç†æ—¶é—´**ï¼šç”Ÿæˆæ–‡ä»¶åˆ—è¡¨çº¦ 1-2 ç§’ï¼ˆå–å†³äºæ–‡ä»¶æ•°é‡ï¼‰

## ğŸ”„ ä¸æ‰‹åŠ¨æ–¹å¼å¯¹æ¯”

| æ“ä½œ | æ‰‹åŠ¨æ–¹å¼ | è‡ªåŠ¨ç›‘è§† |
|------|---------|---------|
| æ·»åŠ å›¾ç‰‡ | 1. å¤åˆ¶å›¾ç‰‡<br>2. è¿è¡Œç”Ÿæˆè„šæœ¬<br>3. å¤åˆ¶æ–‡ä»¶åˆ—è¡¨ | 1. å¤åˆ¶å›¾ç‰‡<br>ï¼ˆè‡ªåŠ¨å®Œæˆå…¶ä»–æ­¥éª¤ï¼‰ |
| å“åº”æ—¶é—´ | éœ€è¦æ‰‹åŠ¨æ“ä½œ | 2 ç§’å†…è‡ªåŠ¨å¤„ç† |
| å‡ºé”™é£é™© | å¯èƒ½å¿˜è®°æ›´æ–° | è‡ªåŠ¨ä¿è¯åŒæ­¥ |
| é€‚ç”¨åœºæ™¯ | å¶å°”æ›´æ–° | é¢‘ç¹æ›´æ–° |

## ğŸ’¡ æœ€ä½³å®è·µ

1. **å¼€å‘æ—¶å¯åŠ¨**ï¼šåœ¨å¼€å‘ç¯å¢ƒä¸­æŒç»­è¿è¡Œç›‘è§†å·¥å…·
2. **æ‰¹é‡æ“ä½œ**ï¼šæ‰¹é‡æ·»åŠ æ–‡ä»¶æ—¶ï¼Œé˜²æŠ–åŠ¨æœºåˆ¶ä¼šè‡ªåŠ¨åˆå¹¶å¤„ç†
3. **æ—¥å¿—è®°å½•**ï¼šç”Ÿäº§ç¯å¢ƒå»ºè®®é‡å®šå‘è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶
4. **å®šæœŸæ£€æŸ¥**ï¼šå®šæœŸæ£€æŸ¥ server ç«¯çš„æ–‡ä»¶åˆ—è¡¨æ˜¯å¦æ­£ç¡®åŒæ­¥

## ğŸš€ è¿›é˜¶ç”¨æ³•

### åå°è¿è¡Œ

```bash
# åå°è¿è¡Œ
nohup ./start-watch.sh > watch.log 2>&1 &

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep watch-and-sync

# åœæ­¢è¿›ç¨‹
kill <PID>
```

### ä½¿ç”¨ systemdï¼ˆLinuxï¼‰

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/watch-and-sync.service`ï¼š

```ini
[Unit]
Description=File Watch and Sync Service
After=network.target

[Service]
Type=simple
User=your-user
WorkingDirectory=/path/to/aipso-static
ExecStart=/usr/bin/python3 /path/to/aipso-static/tools/sync-static-files/watch-and-sync.py
Restart=always

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl enable watch-and-sync
sudo systemctl start watch-and-sync
sudo systemctl status watch-and-sync
```

## ğŸ“ æ€»ç»“

æ–‡ä»¶ç›‘è§†å’ŒåŒæ­¥å·¥å…·æä¾›äº†ï¼š

- âœ… è‡ªåŠ¨æ£€æµ‹æ–‡ä»¶å˜åŒ–
- âœ… è‡ªåŠ¨ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨
- âœ… è‡ªåŠ¨åŒæ­¥åˆ° server ç«¯
- âœ… é˜²æŠ–åŠ¨æœºåˆ¶
- âœ… æ¸…æ™°çš„æ—¥å¿—è¾“å‡º
- âœ… ç®€å•æ˜“ç”¨

è®©å¼€å‘æµç¨‹æ›´åŠ æµç•…ï¼Œæ— éœ€æ‰‹åŠ¨ç»´æŠ¤æ–‡ä»¶åˆ—è¡¨ï¼ğŸ‰
